package install

import (
	"os"
	"log"
	"runtime"
	"os/exec"
	"d4do/pkg/config"
	"d4do/pkg/command"
)

func TofuInstall() {
	switch opSys := runtime.GOOS; opSys {
	case "linux":
		tempDir, _ := os.MkdirTemp(config.AppConfigDir, "temp")
		defer os.RemoveAll(tempDir)

		if isInstalled := CurlCheck(); !isInstalled {
			log.Println("Installing Curl")
			CurlInstall()
		}

		command.Exec("wget", "-o", tempDir + "/tofu.tar.gz", "https://github.com/opentofu/opentofu/releases/download/v1.9.1/tofu_1.9.1_linux_amd64.tar.gz")

		vagrant@tst:~/Workspace$ tar -xvf ./tofu_1.9.1_linux_amd64.tar.gz  -C ./tmp/
		command.Exec("tar", "-xvf", tempDir + "/tofu.tar.gz", "-C", tempDir)
		command.Exec("sudo", "mv", tempDir + "/tofu", "/usr/bin/")

	default:
		log.Fatalln("Cannot install Tofu on current operating system: ", opSys)
	}
}

func TofuCheck() bool {
	if err := exec.Command("tofu", "--version").Run(); err==nil {
		return true
	} 
	return false
}
